let RestaurantAdd = function () {    let $containerOpeningHours = $('div.form-opening-hours');    let $containerExceptionalClosure = $('div.form-exceptional-closure');    let $containerDelivery = $('div.form-delivery');    let $containerImage = $('div.form-images');    let indexOpeningHours = $containerOpeningHours.find(':input').length;    let indexEC = $containerExceptionalClosure.find(':input').length;    let indexDelivery = $containerDelivery.find(':input').length;    let indexImage = $containerImage.find(':input').length;    let addImage = function ($container) {        let $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexImage));        let $imageInput = $prototype.find('input.input-image');        $imageInput.closest('.form-group').wrap("<div class='col-sm-10'></div>");        addDeleteLink($prototype, 1);        $prototype.append($("<div class='col-sm-12 text-center'/>").html('<img id="image_preview_' + indexImage + '" class="img-preview" src="#" alt="Pas d\'image" />'));        $imageInput.attr("data-img", 'image_preview_' + indexImage);        $imageInput.change(function () {            let imageId = $(this).attr('data-img');            imagePreview(this, imageId);            return false;        });        $containerImage.append($('<div class="col-sm-4 row container-object" />').html($prototype).hide().fadeIn("slow"));        indexImage++;        return false;    }    let addOpeningHours = function ($container) {        let $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexOpeningHours));        // console.log($prototype.html());        $prototype.find("label:first").addClass('sr-only');        if ($containerOpeningHours.find('.week-day option:selected').length > 0) {            $prototype.find("label:first-child").addClass('sr-only');        }        $prototype.find('.timepicker').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.week-day').closest('.form-group').wrap("<div class='col-sm-3'></div>");        $container.find('.week-day option:selected').each(function (i, selected) {            $(selected).attr('disabled', 'disabled')            $prototype.find('.week-day option[value="' + $(selected).val() + '"]').attr('disabled', true);        });        $prototype.find('.week-day').val($prototype.find('.week-day option:not(:disabled)').val());        addDeleteLink($prototype, $containerOpeningHours.find('.week-day option:selected').length);        handleTimePickers($prototype);        handleBootstrapSelect($prototype);        $containerOpeningHours.append($('<div class="row container-object" />').html($prototype).hide().fadeIn("slow"));        indexOpeningHours++;        return false;    }    let addDelivery = function ($container) {        let $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexDelivery));        // console.log($prototype.html());        // $prototype.find("label:first").addClass('sr-only');        // if ($containerDelivery.find('.week-day option:selected').length > 0) {        //     $prototype.find("label:first-child").addClass('sr-only');        // }        $prototype.find('.input_delivery_city').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.input_noon_order_min').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.input_night_order_min').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.input_price').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.input_duration_min').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.input_duration_max').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $container.find('.week-day option:selected').each(function (i, selected) {            $(selected).attr('disabled', 'disabled')            $prototype.find('.week-day option[value="' + $(selected).val() + '"]').attr('disabled', true);        });        $prototype.find('.week-day').val($prototype.find('.week-day option:not(:disabled)').val());//        addDeleteLink($prototype, $containerOpeningHours.find('.week-day option:selected').length);        $containerDelivery.append($('<div class="row container-object" />').html($prototype).hide().fadeIn("slow"));        indexDelivery++;        return false;    }    let addExceptionalClosure = function ($container) {        let $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexEC));        $prototype.find("label:first").addClass('sr-only');        if ($containerExceptionalClosure.find('.datepicker').length > 0) {            $prototype.find("label:first-child").addClass('sr-only');        }        $prototype.find('.timepicker').closest('.form-group').wrap("<div class='col-sm-3'></div>");        $prototype.find('.datepicker').closest('.form-group').wrap("<div class='col-sm-5'></div>");        addDeleteLink($prototype, $containerExceptionalClosure.find('.datepicker').length);        handleTimePickers($prototype);        handleBootstrapSelect($prototype);        $prototype.find('.datepicker').datetimepicker({            language: 'fr',            format: "dd/mm/yyyy",            weekStart: 1,            todayBtn: 1,            autoclose: 1,            todayHighlight: 1,            startView: 2,            minView: 2,            // forceParse: 0,            // minuteStep: 10        });        $containerExceptionalClosure.append($('<div class="row container-object" />').html($prototype).hide().fadeIn("slow"));        indexEC++;        return false;    }    let imagePreview = function (input, imageId) {        if (input.files && input.files[0]) {            var reader = new FileReader();            reader.onload = function (e) {                $("#" + imageId).attr('src', e.target.result);            }            reader.readAsDataURL(input.files[0]);        }    }    let addDeleteLink = function ($prototype, margin) {        let $deleteLink = margin == 0 ?            $('<a href="#" class="btn btn-sm margin-top-25 red btn-outline"><i class="fa fa-trash"></i></a>') :            $('<a href="#" class="btn btn-sm red btn-outline"><i class="fa fa-trash"></i></a>');        $prototype.append($('<div class="col-sm-1"/>').html($deleteLink));        // Ajout du listener sur le clic du lien        $deleteLink.click(function (e) {            $prototype.closest(".container-object").remove();            // $prototype.remove();            e.preventDefault(); // évite qu'un # apparaisse dans l'URL            return false;        });    }    /* */    let btnAddExceptionalClosure = function () {        $('#bntExceptionalClosure').click(function (e) {            e.preventDefault();            addExceptionalClosure($containerExceptionalClosure);        })    }    let btnAddOpeningHours = function () {        // if (indexOpeningHours == 0) {        //     $('.loading').remove();        //     addOpeningHours($containerOpeningHours);        // }        $('.loading').remove();        for (var i = 0, l = 7; i < l; i++) {            addOpeningHours($containerOpeningHours);        }        $('#bntOpeningHours').click(function (e) {            e.preventDefault();            if ($containerOpeningHours.find('.week-day option:selected').length <= 6) {                addOpeningHours($containerOpeningHours);            } else {                sweetAlert({                    title: "Attention",                    message: "Vous avez atteint les 7 jours de la semaine.",                    type: "warning",                    allowOutsideClick: true,                    confirmButtonClass: "btn-warning"                })            }        })    }    let btnAddDelivery = function () {        if (indexDelivery == 0) {            // $('.loading').remove();            addDelivery($containerDelivery);        }        $('#addDelivery').click(function (e) {            e.preventDefault();            addDelivery($containerDelivery);        })    }    let btnImages = function () {        if (indexImage == 0) {            addImage($containerImage);        }        $('#btnImageAdd').click(function (e) {            e.preventDefault();            addImage($containerImage);        });    }    let handleBootstrapSelect = function ($container) {        let $bsSelect = $container ? $container.find('.bs-select') : $('.bs-select');        $bsSelect.selectpicker({            iconBase: 'fa',            tickIcon: 'fa-check',            noneSelectedText: '-- Choix --',            size: 7,            windowPadding: 'right'        });        // $(".bs-select").removeClass('hide');    }    let handleTimePickers = function ($container) {        let $timePicker = $container ? $container.find('.timepicker') : $('.timepicker');        $timePicker.timepicker({            autoclose: true,            minuteStep: 5,            showSeconds: false,            showMeridian: false,            dropdownAlignRight: true        });    }    let removeHideInput = function () {        $('#input_description').removeClass("hide").hide().fadeIn("slow");    }    let mapGeocoding = function () {        let map = new GMaps({            div: '#gmap_geocoding',            lat: 48.8534,            lng: 2.3488        });        let handleAction = function () {            let address = $.trim($('.input_address').val());            let city = $.trim($('.input_city :selected').text());            if (city && address) {                GMaps.geocode({                    address: address + ", " + city,                    callback: function (results, status) {                        if (status == 'OK') {                            let latlng = results[0].geometry.location;                            map.setCenter(latlng.lat(), latlng.lng());                            map.addMarker({                                lat: latlng.lat(),                                lng: latlng.lng()                            });                            App.scrollTo($('#gmap_geocoding'));                        }                    }                });            } else {                sweetAlert({                    title: "Attention",                    message: "Veuillez remplir le champ Rue, Adresse et Ville",                    type: "warning",                    allowOutsideClick: true,                    confirmButtonClass: "btn-warning"                });            }        }        $('#gmap_geocoding_btn').click(function (e) {            e.preventDefault();            handleAction();        });        $(".input_address,.input_city").change(function () {            if ($.trim($('.input_address').val())                && $.trim($('.input_city :selected').text())) {                handleAction();            }        });    }    let inputAddress = function () {        $(document).on('change', '#appbundle_restaurant_region, #appbundle_restaurant_department', function () {            let $field = $(this)            if ($field.attr('id') == 'appbundle_restaurant_region') {                console.log("Change Region: okok");                $('#appbundle_restaurant_department, #appbundle_restaurant_city').prop('disabled', true)            } else if ($field.attr('id') == 'appbundle_restaurant_department') {                console.log("Change Region: okok");                console.log("Departement :" + $('#appbundle_restaurant_department').is(':disabled'));                console.log("City :" + $('#appbundle_restaurant_city').is(':disabled'));                if (!$('#appbundle_restaurant_city').is(':disabled'))                    $('#appbundle_restaurant_city').prop('disabled', true);            }            console.log("Après conditions: ");            console.log("Departement :" + $('#appbundle_restaurant_department').is(':disabled'));            console.log("City :" + $('#appbundle_restaurant_city').is(':disabled'));            let $regionField = $('#appbundle_restaurant_region')            // let $communesDelivered =             let $form = $field.closest('form')            let target = '#' + $field.attr('id').replace('department', 'city').replace('region', 'department');            let data = {}            data[$regionField.attr('name')] = $regionField.val()            data[$field.attr('name')] = $field.val()//                debugger;            // On soumet les données            $.post($form.attr('action'), data).then(function (data) {                // On récupère le nouveau <select>                let $input = $(data).find(target)                console.log("POST conditions: ");                console.log($(target).is(':disabled'));                if ($(target).is(':disabled')) {                    console.log(target);                    $(target).prop('disabled', false);                    console.log($(target).is(':disabled'));                }                // On remplace notre <select> actuel                $(target).replaceWith($input);                $(target).closest('.form-group').find("button:first").remove();                $(target).selectpicker('refresh');                // handleBootstrapSelect($(target))                if (target == "#appbundle_restaurant_city") {                    //$communesDelivered.selectpicker('refresh');                    let $inputCD = $(data).find('#appbundle_restaurant_communesDelivered');                    $('#appbundle_restaurant_communesDelivered').replaceWith($inputCD);                    $('#appbundle_restaurant_communesDelivered').closest('.form-group').find('button:first').remove();                    $('#appbundle_restaurant_communesDelivered').selectpicker('refresh');                }            })        });    }    let sweetAlert = function (option) {        swal({                title: option.title,                text: option.message,                type: option.type,                allowOutsideClick: option.allowOutsideClick,                showConfirmButton: option.showConfirmButton,                showCancelButton: option.showCancelButton,                confirmButtonClass: option.confirmButtonClass,                cancelButtonClass: option.cancelButtonClass,                closeOnConfirm: option.closeOnConfirm,                closeOnCancel: option.closeOnCancel,                confirmButtonText: option.confirmButtonText,                cancelButtonText: option.cancelButtonText,            },            function (isConfirm) {                if (isConfirm) {                    swal(option.popupTitleSuccess, option.popupMessageSuccess, "success");                } else {                    swal(option.popupTitleCancel, option.popupMessageCancel, "error");                }            });    }    return {        init: function () {            handleBootstrapSelect();            handleTimePickers();            btnAddOpeningHours();            btnAddExceptionalClosure();            btnAddDelivery();            btnImages();            removeHideInput();            mapGeocoding();            inputAddress();        }    }}();jQuery(document).ready(function () {    RestaurantAdd.init();});