var RestaurantAdd = function () {    var $containerOpeningHours = $('div.form-opening-hours');    var $containerExceptionalClosure = $('div.form-exceptional-closure');    var indexOpeningHours = $containerOpeningHours.find(':input').length;    var indexEC = $containerExceptionalClosure.find(':input').length;    var addOpeningHours = function ($container) {        var $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexOpeningHours));        // console.log($prototype.html());        $prototype.find("label:first").addClass('sr-only');        if ($containerOpeningHours.find('.week-day option:selected').length > 0) {            $prototype.find("label:first-child").addClass('sr-only');        }        $prototype.find('.timepicker').closest('.form-group').wrap("<div class='col-sm-2'></div>");        $prototype.find('.week-day').closest('.form-group').wrap("<div class='col-sm-3'></div>");        $container.find('.week-day option:selected').each(function (i, selected) {            $(selected).attr('disabled', 'disabled')            $prototype.find('.week-day option[value="' + $(selected).val() + '"]').attr('disabled', true);        });        $prototype.find('.week-day').val($prototype.find('.week-day option:not(:disabled)').val());        addDeleteLink($prototype, $containerOpeningHours.find('.week-day option:selected').length);        handleTimePickers($prototype);        handleBootstrapSelect($prototype);        $containerOpeningHours.append($('<div class="row" />').html($prototype).hide().fadeIn("slow"));        indexOpeningHours++;        return false;    }    var addExceptionalClosure = function ($container) {        var $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, '')            .replace(/__name__/g, indexEC));        $prototype.find("label:first").addClass('sr-only');        if ($containerExceptionalClosure.find('.datepicker').length > 0) {            $prototype.find("label:first-child").addClass('sr-only');        }        $prototype.find('.timepicker').closest('.form-group').wrap("<div class='col-sm-3'></div>");        $prototype.find('.datepicker').closest('.form-group').wrap("<div class='col-sm-5'></div>");        addDeleteLink($prototype, $containerExceptionalClosure.find('.datepicker').length);        handleTimePickers($prototype);        handleBootstrapSelect($prototype);        $prototype.find('.datepicker').datetimepicker({            language: 'fr',            format: "dd/mm/yyyy",            weekStart: 1,            todayBtn: 1,            autoclose: 1,            todayHighlight: 1,            startView: 2,            minView: 2,            // forceParse: 0,            // minuteStep: 10        });        $containerExceptionalClosure.append($('<div class="row" />').html($prototype).hide().fadeIn("slow"));        indexEC++;        return false;    }    var addDeleteLink = function ($prototype, margin) {        if (margin == 0) {            var $deleteLink = $('<a href="#" class="btn btn-sm margin-top-25 red btn-outline"><i class="fa fa-trash"></i></a>');        } else {            var $deleteLink = $('<a href="#" class="btn btn-sm red btn-outline"><i class="fa fa-trash"></i></a>');        }        $prototype.append($('<div class="col-sm-1"/>').html($deleteLink));        // Ajout du listener sur le clic du lien        $deleteLink.click(function (e) {            $prototype.remove();            e.preventDefault(); // évite qu'un # apparaisse dans l'URL            return false;        });    }    var btnAddExceptionalClosure = function () {        $('#bntExceptionalClosure').click(function (e) {            console.log('test');            e.preventDefault();            addExceptionalClosure($containerExceptionalClosure);        })    }    var btnAddOpeningHours = function () {        if (indexOpeningHours == 0) {            $('.loading').remove();            addOpeningHours($containerOpeningHours);        }        $('#bntOpeningHours').click(function (e) {            e.preventDefault();            if ($containerOpeningHours.find('.week-day option:selected').length <= 6) {                addOpeningHours($containerOpeningHours);            } else {                console.log('Vous avez atteint les 7 jours de la semaine. ');            }        })    }    var handleBootstrapSelect = function ($container) {        var $bsSelect = $container ? $container.find('.bs-select') : $('.bs-select');        $bsSelect.selectpicker({            iconBase: 'fa',            tickIcon: 'fa-check',            noneSelectedText: '-- Choix --',        });        // $(".bs-select").removeClass('hide');    }    var handleTimePickers = function ($container) {        var $timePicker = $container ? $container.find('.timepicker') : $('.timepicker');        $timePicker.timepicker({            autoclose: true,            minuteStep: 5,            showSeconds: false,            showMeridian: false        });    }    var removeHideInput = function () {        $('#input_description').removeClass("hide").hide().fadeIn("slow");    }    var mapGeocoding = function () {        var map = new GMaps({            div: '#gmap_geocoding',            lat: 48.8534,            lng: 2.3488        });        var handleAction = function () {            var street = $.trim($('.input_street').val());            var content = $.trim($('.input_content').val());            var city = $.trim($('.input_city :selected').text());            console.log(street);            console.log(city);            console.log(content);            if (street && city && content) {                var address = street + " " + content + " " + city;                console.log(address);                GMaps.geocode({                    address: address,                    callback: function (results, status) {                        if (status == 'OK') {                            var latlng = results[0].geometry.location;                            map.setCenter(latlng.lat(), latlng.lng());                            map.addMarker({                                lat: latlng.lat(),                                lng: latlng.lng()                            });                            App.scrollTo($('#gmap_geocoding'));                        }                    }                });            } else {                sweetAlert({                    title: "Erreur",                    message: "Veuillez remplir les champs Rue, Addres, Ville",                    type: "warning",                    allowOutsideClick: true,                    confirmButtonClass: "btn-warning"                })            }        }        $('#gmap_geocoding_btn').click(function (e) {            e.preventDefault();            handleAction();        });        $(".input_street,.input_content,.input_city").change(function () {            if ($.trim($('.input_street').val()) && $.trim($('.input_content').val())                && $.trim($('.input_city :selected').text())) {                handleAction();            }        });    }    var inputAddress = function () {        $(document).on('change', '#appbundle_restaurant_region, #appbundle_restaurant_department', function () {            let $field = $(this)            let $regionField = $('#appbundle_restaurant_region')            // let $communesDelivered =             let $form = $field.closest('form')            let target = '#' + $field.attr('id').replace('department', 'city').replace('region', 'department');            let data = {}            data[$regionField.attr('name')] = $regionField.val()            data[$field.attr('name')] = $field.val()//                debugger;            // On soumet les données            $.post($form.attr('action'), data).then(function (data) {                // On récupère le nouveau <select>                let $input = $(data).find(target)                // On remplace notre <select> actuel                $(target).replaceWith($input);                $(target).closest('.form-group').find("button:first").remove();                $(target).selectpicker('refresh');                // handleBootstrapSelect($(target))                if (target == "#appbundle_restaurant_city") {                    //$communesDelivered.selectpicker('refresh');                    let $inputCD = $(data).find('#appbundle_restaurant_communesDelivered');                    console.log($inputCD);                    $('#appbundle_restaurant_communesDelivered').replaceWith($inputCD);                    $('#appbundle_restaurant_communesDelivered').closest('.form-group').find('button:first').remove();                    $('#appbundle_restaurant_communesDelivered').selectpicker('refresh');                }            })        })    }    var sweetAlert = function (option) {        swal({                title: option.title,                text: option.message,                type: option.type,                allowOutsideClick: option.allowOutsideClick,                showConfirmButton: option.showConfirmButton,                showCancelButton: option.showCancelButton,                confirmButtonClass: option.confirmButtonClass,                cancelButtonClass: option.cancelButtonClass,                closeOnConfirm: option.closeOnConfirm,                closeOnCancel: option.closeOnCancel,                confirmButtonText: option.confirmButtonText,                cancelButtonText: option.cancelButtonText,            },            function (isConfirm) {                if (isConfirm) {                    swal(option.popupTitleSuccess, option.popupMessageSuccess, "success");                } else {                    swal(option.popupTitleCancel, option.popupMessageCancel, "error");                }            });    }    return {        init: function () {            handleBootstrapSelect();            handleTimePickers();            btnAddOpeningHours();            btnAddExceptionalClosure();            removeHideInput();            mapGeocoding();            inputAddress();        }    }}();jQuery(document).ready(function () {    RestaurantAdd.init();});